#!/bin/zsh
autoload -Uz zmathfunc; zmathfunc

_autocomplete__max_lines() {
  (( _autocomplete__screen_space = min(
    ++_autocomplete__screen_space, LINES - BUFFERLINES - _autocomplete__pslines() )))
  return $(( max( 5, _autocomplete__screen_space) ))
}

_autocomplete__pslines() {
  return ${#${(f@)PS1}}
}

functions -M _autocomplete__max_lines 0
functions -M _autocomplete__pslines 0
