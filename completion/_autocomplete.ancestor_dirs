#autoload
[[ $_comp_tags == *( | local-)'directories '* ]] ||
  return

local tag=ancestor-directories
_tags $tag
( _tags && _requested $tag ) ||
  return

local -a expl dirs=( "$PWD:h" )

[[ $dirs[-1] == / ]] &&
  return 1

local _comp_no_ignore=yes
_description -V $tag expl "ancestor directory"

while (( $#dirs[-1] > 1 )); do
  dirs+=( "$dirs[-1]:h" )
done
local -a displ=( "${(@D)dirs}" )
compadd "$expl[@]" -d displ -fW / - "$dirs[@]"

return 1  # Always continue to next completer.
